// Chat records as generated by (Private)ChatWindow and stored in a chat history.

import { is } from './is';

export enum ChatType {
    roompublic = 'roompublic',
    roomprivate = 'roomprivate',
}

export type ChatMessage = {
    type:      ChatType; // \
    roomJid:   string;   //  > Same for all messages of a chat window.
    roomNick:  string;   // /
    timestamp: string;
    id:        string;
    nick:      string;
    text:      string;
};

export function isChatRecordType(val: unknown): val is ChatType
{
    return is.string(val) && Object.values<string>(ChatType).includes(val);
}

export function isChatMessage(val: unknown): val is ChatMessage
{
    return !is.nil(val)
    && isChatRecordType(val['type'])
    && is.string(val['roomJid'])
    && is.string(val['roomNick'])
    && !(val['roomNick'] !== '' && val['type'] === ChatType.roompublic)
    && is.string(val['timestamp'])
    && is.string(val['id'])
    && is.string(val['nick'])
    && is.string(val['text'])
    ;
}

let makeChatMessageId_nr = 0;
export function makeChatMessageId(): string
{
    makeChatMessageId_nr++;
    return `${Date.now()}:${makeChatMessageId_nr}`;
}
